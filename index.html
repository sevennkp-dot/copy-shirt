<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üëï ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≠‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡∏∑‡πâ‡∏≠ (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#f4f4f4;padding:20px}
  .card{max-width:560px;margin:auto;background:#fff;border-radius:14px;padding:20px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
  h2{text-align:center;margin:0 0 10px}
  p{color:#555;text-align:center}
  input,button{width:100%;padding:12px;margin-top:12px;font-size:16px}
  button{background:#000;color:#fff;border:none;border-radius:10px;cursor:pointer}
  button:hover{opacity:.85}
  canvas{width:100%;margin-top:15px;border-radius:10px;background:#eee}
  .hint{font-size:13px;color:#777;margin-top:10px;text-align:center}
  .mockup{margin-top:20px;text-align:center}
  .shirt{width:260px;height:320px;margin:auto;position:relative;border-radius:20px;background:#fff;box-shadow:inset 0 0 0 2px #ddd}
  .print{position:absolute;top:90px;left:50%;transform:translateX(-50%);width:140px}
</style>
</head>
<body>
  <div class="card">
    <h2>üëï ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏≠‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡∏∑‡πâ‡∏≠</h2>
    <p>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ü‡∏•‡πå ‚Üí ‡∏£‡πâ‡∏≤‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>

    <input type="file" id="file" accept="image/*" />

    <button onclick="traceImage()">‡∏•‡∏≠‡∏Å‡∏•‡∏≤‡∏¢ (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô)</button>
    <button onclick="exportAll()">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå (‡∏´‡∏ô‡πâ‡∏≤ / ‡∏´‡∏•‡∏±‡∏á / ‡πÅ‡∏Ç‡∏ô / ‡∏Ñ‡∏≠)</button>

    <canvas id="c"></canvas>

    <div class="mockup">
      <h3>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå</h3>
      <div class="shirt">
        <img id="printImg" class="print" />
      </div>
    </div>

    <div class="hint">
      ‚Ä¢ ‡∏Ç‡∏ô‡∏≤‡∏î‡∏•‡∏≤‡∏¢: ‡∏Å‡∏•‡∏≤‡∏á‡∏≠‡∏Å 30 ‡∏ã‡∏°.<br>
      ‚Ä¢ ‡πÇ‡∏´‡∏°‡∏î‡∏û‡∏¥‡∏°‡∏û‡πå: DTF (‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏¥‡∏¢‡∏°)<br>
      ‚Ä¢ ‡πÑ‡∏ü‡∏•‡πå PNG ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ 300 DPI<br>
      ‚ûú ‡∏£‡πâ‡∏≤‡∏ô‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    </div>
  </div>

<script>
// ===== Canvas Setup =====
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const printImg = document.getElementById('printImg');

// ===== ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô =====
const PRINT_MODE = 'DTF';
const BASE_PRINT_WIDTH = 3543; // 30 ‡∏ã‡∏°. @300DPI

// ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (px @300DPI)
const AREAS = {
  FRONT: 3543,
  BACK: 3543,
  SLEEVE: 1417,
  NECK: 1181
};

// ===== Trace Image =====
function traceImage(){
  const fileInput = document.getElementById('file');
  const file = fileInput.files[0];
  if(!file){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ'); return; }

  const img = new Image();
  img.onload = function(){
    const ratio = img.height / img.width;
    canvas.width = BASE_PRINT_WIDTH;
    canvas.height = Math.round(BASE_PRINT_WIDTH * ratio);

    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img,0,0,canvas.width,canvas.height);

    const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
    const d = imageData.data;

    for(let i=0;i<d.length;i+=4){
      const gray = d[i]*0.299 + d[i+1]*0.587 + d[i+2]*0.114;
      const v = gray > 130 ? 255 : 0;
      d[i] = d[i+1] = d[i+2] = v;
      d[i+3] = v === 255 ? 255 : 0;
    }

    ctx.putImageData(imageData,0,0);
    printImg.src = canvas.toDataURL('image/png');
  };

  img.src = URL.createObjectURL(file);
}

// ===== Export Files =====
function exportAll(){
  if(canvas.width === 0){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏Å‡∏•‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô'); return; }

  const ratio = canvas.height / canvas.width;

  Object.entries(AREAS).forEach(function(entry){
    const area = entry[0];
    const width = entry[1];

    const tmp = document.createElement('canvas');
    const tctx = tmp.getContext('2d');

    tmp.width = width;
    tmp.height = Math.round(width * ratio);

    tctx.clearRect(0,0,tmp.width,tmp.height);
    tctx.drawImage(canvas,0,0,tmp.width,tmp.height);

    const link = document.createElement('a');
    link.download = 'PRINT_' + area + '_' + Math.round(width/118) + 'CM_' + PRINT_MODE + '.png';
    link.href = tmp.toDataURL('image/png');
    link.click();
  });
}

// ===== Test cases (basic sanity) =====
// Test 1: exportAll() without tracing should alert
// Test 2: traceImage() sets canvas.width === BASE_PRINT_WIDTH
</script>
</body>
</html>
